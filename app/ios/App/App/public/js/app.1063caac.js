(function(){var e={7978:function(e){function t(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=function(){return[]},t.resolve=t,t.id=7978,e.exports=t},1993:function(e){function t(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=function(){return[]},t.resolve=t,t.id=1993,e.exports=t},995:function(e,t,n){"use strict";var a=n(9963),o=n(6252),s=n(2262),l=n(5516),i=n(1174);function r(){const e=async()=>{const e=await i.mR.checkPermission({force:!0});console.log("Permission granted: ",e.granted),i.mR.hideBackground();const t=await i.mR.startScan();if(t.hasContent)return console.log(t.content),console.log("End of scan."),t.content;console.log("End of scan.")},t=()=>{i.mR.stopScan()};return{startScan:e,stopScan:t}}const c={class:"scanner-ui justify-center"},u=(0,o.Uk)(" Go back ");var d=(0,o.aZ)({__name:"App",setup(e){const{stopScan:t}=r(),n=()=>{t(),document.body.classList.remove("qrscanner")};return(e,t)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)((0,s.SU)(l.dr),{class:"scanner-hide"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.jP))])),_:1}),(0,o._)("div",c,[(0,o.Wm)((0,s.SU)(l.YG),{onClick:n,class:"ionic-bg-secondary absolute bottom-2 font-bold text-white"},{default:(0,o.w5)((()=>[u])),_:1})])],64))}});const f=d;var m=f,g=n(1089),v=(n(7658),n(3577)),p=n(9081);function w(){let e;const t=[],n=(0,s.iH)();let a,o;const l=e=>o=e,i=e=>{u(e)},r=()=>{console.log("Starting ctx."),e=new AudioContext,e.onstatechange=()=>{o("Ctx state changed to: "+e.state),"suspended"!==e.state&&"interrupted"!==e.state||e.resume(),"running"===e.state&&m()},y()};let c;const u=async a=>{if(y(),n.value=c,a.partials)for(const n of a.partials){const a=t.find((e=>e.index===n.index));if(a)console.log("Found osc."),d(a.oscillator,a.gain,n.breakpoints,c+n.endTime);else{if(!e)return;console.log("Creating osc.");const a=e.createOscillator(),o=e.createGain();a.connect(o),o.connect(e.destination),a.type=k,a.start(c+n.startTime),d(a,o,n.breakpoints,c+n.endTime),a.stop(c+n.endTime),a.onended=e=>{const n=t.find((t=>t.oscillator===e.target));n&&t.splice(t.indexOf(n),1)},t.push({index:n.index,oscillator:a,gain:o})}}if(a.ttsInstructions){const e=a.ttsInstructions;console.log("Speaking: ",e),await g(e)}},d=(e,t,a,o)=>{e.stop(o);for(const s of a)e.frequency.setValueAtTime(s.freq,n.value+s.time),t.gain.setValueAtTime(s.amp,n.value+s.time)},f=e=>c=e-a,m=()=>{for(const e of t)e.oscillator.stop()},g=async e=>{await p.w.speak({text:e,lang:v,rate:S,pitch:1,volume:1,category:"playback"})};let v;const w=e=>{v=e};let b=(0,s.qj)({pos:-1});const h=e=>b=e,y=()=>a=b.pos-e.currentTime;let k,S=1;const _=(e,t)=>{k=e,S=+t},U=()=>{const t=e?e.currentTime:void 0;return{ctxTime:t,offset:a}};let x;const T=()=>{if(!e)return;const t=e.createOscillator();t.frequency.setValueAtTime(440,e.currentTime);const n=e.createGain();n.gain.setValueAtTime(.05,e.currentTime),t.connect(n),n.connect(e.destination),x={oscillator:t,gain:n},t.start()},O=()=>{x&&(x.oscillator.stop(),x=null)};return{handleChunkData:u,initialSetup:i,startAudioCtx:r,setStartTime:f,setLogFunction:l,setTtsLanguage:w,setMotionRef:h,setTrackSettings:_,getDebugData:U,stopPlayback:m,playContinuousSound:T,stopContinuousSound:O,setOffset:y}}var b=n(9895),h=n(441),y=n(4571);const k={class:"flex h-full flex-col items-center justify-center bg-primary"},S={key:0},_={key:0,class:"flex w-[20rem] flex-col items-start text-white"},U=(0,o.Uk)("Choir ID:"),x=(0,o.Uk)("TTS language:"),T=(0,o.Uk)("English"),O=(0,o.Uk)("Deutsch"),W=(0,o.Uk)(" Scan"),j=(0,o._)("br",null,null,-1),C=(0,o.Uk)("QR-Code "),D={key:3},P={key:4,class:"absolute bottom-0"},L={class:"min-w-[20%]"},q={class:"align-left"};var N=(0,o.aZ)({__name:"MainPage",setup(e){const t=!1,n="8844095860530063641",a="wss://sadiss.net/ws/",i=(0,s.iH)(!1),c=(0,s.iH)(),u=(0,s.iH)(1),d=(0,s.iH)("en-US"),{handleChunkData:f,startAudioCtx:m,setStartTime:g,setLogFunction:p,setTtsLanguage:N,setMotionRef:I,setTrackSettings:A,getDebugData:E,stopPlayback:V,setOffset:H}=w(),R=(0,s.iH)({ctxTime:-1,offset:-1});t&&setInterval((()=>{R.value=E()}),50);const{startScan:G,stopScan:Y}=r();let M=!1;const z=()=>{M||i.value||(M=!0,m(),X("Audio ctx started."),N(d.value),F())},F=()=>{c.value=new WebSocket(a),c.value.onopen=function(){X("Websocket connection opened."),i.value=!0,M=!1,this.send(JSON.stringify({message:"clientInfo",clientId:u.value,ttsLang:d.value}))},c.value.onclose=()=>{X("Websocket connection closed."),i.value=!1,M=!1,V()},c.value.onerror=e=>{i.value=!1,M=!1,V(),console.error(e)},c.value.onmessage=e=>{if(!e.data)return void X("Keep Alive Message received.");const t=JSON.parse(e.data);if(console.log("\nReceived message: ",Object.keys(t)),t.start&&(X("Initial setting of offset."),H()),t.stop)return X("Track stopped."),void V();g(t.startTime),A(t.waveform,t.ttsRate),Object.keys(t.chunk)&&(t.chunk.partials&&X("Partials: "+t.chunk.partials.map((e=>e.index)).sort(((e,t)=>e-t)).join(", ")),t.chunk.ttsInstructions&&X("TTS: "+t.chunk.ttsInstructions),f(t.chunk))}};let Q;const J=(0,s.iH)(!1),K=async()=>{const e=MCorp.app(n,{anon:!0});e.run=()=>{Q=(0,s.qj)(e.motions["shared"]),J.value=!0,I(Q)},e.init()},Z=async()=>{document.body.classList.add("qrscanner");const e=await G();X("QR scan result: "+e),e&&!Number.isNaN(+e)&&(u.value=+e),document.body.classList.remove("qrscanner")};(0,o.bv)((async()=>{const e=await y.u.get({key:"choirId"});e.value&&(u.value=+e.value);const t=await y.u.get({key:"selectedLanguage"});t.value&&(d.value=t.value),await K()}));const $=(0,s.iH)(null),B=(0,s.iH)([]),X=e=>{if(!t)return;console.log(e);const n=(new Date).toLocaleString();B.value.push({text:e,timestamp:n.slice(11,n.length)}),$.value&&$.value.scrollIntoView()};return p(X),(0,o.se)((()=>{document.body.classList.remove("qrscanner"),Y()})),(0,o.YP)((()=>B.value.length),(()=>{const e=$.value?.lastElementChild;e&&e.scrollIntoView({behavior:"smooth"})})),(0,o.YP)((()=>u.value),(async(e,t)=>{"number"===typeof e&&e!==t&&await y.u.set({key:"choirId",value:String(e)})})),(0,o.YP)((()=>i.value),(async e=>{try{"web"!==b.dV.getPlatform()&&(e?(await h.P.keepAwake(),X("KeepAwake enabled.")):(await h.P.allowSleep(),X("KeepAwake disabled.")))}catch(t){X(t.toString())}})),(e,n)=>((0,o.wg)(),(0,o.j4)((0,s.SU)(l._i),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Gu),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.sr),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Sm),{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.oU),{hidden:i.value},null,8,["hidden"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)((0,s.SU)(l.W2),{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o._)("div",k,[t?((0,o.wg)(),(0,o.iD)("div",S,[(0,s.SU)(Q)&&(0,s.SU)(Q).pos?((0,o.wg)(),(0,o.iD)("div",_,[(0,o._)("p",null,"ctx Time: "+(0,v.zw)(R.value.ctxTime),1),(0,o._)("p",null,"Offset: "+(0,v.zw)(R.value.offset),1),(0,o._)("p",null,"Global Time: "+(0,v.zw)((0,s.SU)(Q).pos),1),(0,o._)("p",null,"Calced Global Time: "+(0,v.zw)(R.value.ctxTime+R.value.offset),1),(0,o._)("p",null,"Diff: "+(0,v.zw)((0,s.SU)(Q).pos-R.value.offset-R.value.ctxTime),1)])):(0,o.kq)("",!0)])):(0,o.kq)("",!0),t?((0,o.wg)(),(0,o.j4)((0,s.SU)(l.Ie),{key:1,class:"ionic-bg-secondary b-0 mb-2 w-[80%] border-0 text-white",lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Q$),null,{default:(0,o.w5)((()=>[U])),_:1}),(0,o.Wm)((0,s.SU)(l.pK),{type:"number",modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=e=>u.value=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1})):(0,o.kq)("",!0),t?((0,o.wg)(),(0,o.j4)((0,s.SU)(l.Ie),{key:2,class:"ionic-bg-secondary mb-2 w-[80%] text-white",lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Q$),null,{default:(0,o.w5)((()=>[x])),_:1}),(0,o.Wm)((0,s.SU)(l.t9),{modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=e=>d.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.n0),{value:"en-US"},{default:(0,o.w5)((()=>[T])),_:1}),(0,o.Wm)((0,s.SU)(l.n0),{value:"de-DE"},{default:(0,o.w5)((()=>[O])),_:1})])),_:1},8,["modelValue"])])),_:1})):(0,o.kq)("",!0),(0,o.Wm)((0,s.SU)(l.YG),{onClick:z,disabled:!J.value,class:(0,v.C_)(["ionic-rounded-full ionic-bg-secondary h-[60vw] w-[60vw] text-2xl font-bold",{"ionic-border-highlight text-highlight":i.value}])},{default:(0,o.w5)((()=>[(0,o.Uk)((0,v.zw)(i.value?"Registered":"Register"),1)])),_:1},8,["disabled","class"]),(0,o.Wm)((0,s.SU)(l.YG),{onClick:Z,disabled:i.value,class:"ionic-bg-secondary mt-4 h-[60px] font-bold"},{default:(0,o.w5)((()=>[W,j,C])),_:1},8,["disabled"]),t?((0,o.wg)(),(0,o.iD)("p",D,"v1.0.0")):((0,o.wg)(),(0,o.iD)("p",P," v1.0.0 ")),t?((0,o.wg)(),(0,o.iD)("div",{key:5,class:"absolute bottom-0 h-[20%] w-full overflow-scroll bg-secondary",ref_key:"logContainer",ref:$},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(B.value,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:"flex w-full text-white"},[(0,o._)("span",L,(0,v.zw)(e.timestamp),1),(0,o._)("span",q,(0,v.zw)(e.text),1)])))),128))],512)):(0,o.kq)("",!0)])])),_:1})])),_:1}))}});const I=N;var A=I;const E={class:"flex h-full w-full items-center justify-center bg-primary"},V=(0,o.Uk)(" Scan"),H=(0,o._)("br",null,null,-1),R=(0,o.Uk)("QR-Code ");var G=(0,o.aZ)({__name:"QrScannerPage",setup(e){const t=(0,l.cj)(),{startScan:n,stopScan:a}=r(),i=async()=>{document.body.classList.add("qrscanner");const e=await n();if(e){const n=await JSON.parse(e),a=n.choirId;a&&!Number.isNaN(+a)&&await y.u.set({key:"choirId",value:String(a)}),n.tts?(await y.u.set({key:"availableLanguages",value:JSON.stringify(n.tts)}),t.navigate("/language-selection","forward","push")):t.navigate("/main","forward","push")}c()},c=()=>{a(),document.body.classList.remove("qrscanner")};return(0,o.se)((()=>{document.body.classList.remove("qrscanner"),a()})),(e,t)=>((0,o.wg)(),(0,o.j4)((0,s.SU)(l._i),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.W2),{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o._)("div",E,[(0,o.Wm)((0,s.SU)(l.YG),{onClick:i,class:"ionic-rounded-full ionic-bg-secondary h-[200px] w-[200px] text-2xl"},{default:(0,o.w5)((()=>[V,H,R])),_:1})])])),_:1})])),_:1}))}});const Y=G;var M=Y;const z={class:"flex h-full w-full flex-col items-center justify-center gap-8 bg-primary"},F=(0,o.Uk)("Please select a language "),Q=(0,o.Uk)(" Done ");var J=(0,o.aZ)({__name:"LanguageSelectionPage",setup(e){const t=(0,l.cj)(),n=(0,s.iH)([{iso:"de-DE",lang:"Deutsch"}]),a=(0,s.iH)();return(0,o.bv)((async()=>{try{const e=await y.u.get({key:"availableLanguages"});if(e.value){const t=await JSON.parse(e.value);console.log("Parsed json: ",t),n.value=await JSON.parse(e.value)}}catch(e){console.log("Failed mounting lang selection page.")}})),(0,o.YP)((()=>a.value),(async e=>{await y.u.set({key:"selectedLanguage",value:e})})),(e,i)=>((0,o.wg)(),(0,o.j4)((0,s.SU)(l._i),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Gu),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.sr),null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Sm),{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.oU))])),_:1})])),_:1})])),_:1}),(0,o.Wm)((0,s.SU)(l.W2),{fullscreen:!0},{default:(0,o.w5)((()=>[(0,o._)("div",z,[(0,o.Wm)((0,s.SU)(l.Ie),{class:"ionic-bg-secondary w-[80%]",lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(l.Q$),{position:"stacked",color:"light"},{default:(0,o.w5)((()=>[F])),_:1}),(0,o.Wm)((0,s.SU)(l.t9),{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=e=>a.value=e),class:"w-full text-white"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.value,(e=>((0,o.wg)(),(0,o.j4)((0,s.SU)(l.n0),{key:e.iso,value:e.iso},{default:(0,o.w5)((()=>[(0,o.Uk)((0,v.zw)(e.lang),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)((0,s.SU)(l.YG),{onClick:i[1]||(i[1]=e=>(0,s.SU)(t).navigate("/main","forward","push")),disabled:!a.value,class:"ionic-rounded-full ionic-bg-secondary h-[100px] w-[100px] text-2xl"},{default:(0,o.w5)((()=>[Q])),_:1},8,["disabled"])])])),_:1})])),_:1}))}});const K=J;var Z=K;const $=[{path:"/",redirect:"/qr-scanner"},{path:"/main",name:"Main",component:A},{path:"/qr-scanner",name:"QrScanner",component:M},{path:"/language-selection",name:"LanguageSelection",component:Z}],B=(0,g.p7)({history:(0,g.PO)("/"),routes:$});var X=B;n(6816),n(784),n(3044),n(4387),n(2724),n(7820),n(2223),n(5273),n(4658),n(6313);const ee=(0,a.ri)(m).use(l.oX).use(X);X.isReady().then((()=>{ee.mount("#app")}))}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,s){if(!a){var l=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],s=e[u][2];for(var i=!0,r=0;r<a.length;r++)(!1&s||l>=s)&&Object.keys(n.O).every((function(e){return n.O[e](a[r])}))?a.splice(r--,1):(i=!1,s<l&&(l=s));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,a){return n.f[a](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/"+e+"."+{78:"bd4504f1",85:"102f9586",338:"a7f8a2e5",452:"d4160480",541:"10bb8f33",544:"6ada12ea",561:"4c599e5f",576:"eae3dab8",595:"321dc8b5",640:"dbdcfc65",753:"51d24443",775:"013a7655",823:"08d2f57f",990:"1f516387"}[e]+".js"}}(),function(){n.miniCssF=function(e){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="sadiss_app:";n.l=function(a,o,s,l){if(e[a])e[a].push(o);else{var i,r;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==t+s){i=d;break}}i||(r=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+s),i.src=a),e[a]=[o];var f=function(t,n){i.onerror=i.onload=null,clearTimeout(m);var o=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((function(e){return e(n)})),t)return t(n)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=f.bind(null,i.onerror),i.onload=f.bind(null,i.onload),r&&document.head.appendChild(i)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){var e={143:0};n.f.j=function(t,a){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else{var s=new Promise((function(n,a){o=e[t]=[n,a]}));a.push(o[2]=s);var l=n.p+n.u(t),i=new Error,r=function(a){if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var s=a&&("load"===a.type?"missing":a.type),l=a&&a.target&&a.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+l+")",i.name="ChunkLoadError",i.type=s,i.request=l,o[1](i)}};n.l(l,r,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,s,l=a[0],i=a[1],r=a[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(r)var u=r(n)}for(t&&t(a);c<l.length;c++)s=l[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},a=self["webpackChunksadiss_app"]=self["webpackChunksadiss_app"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(995)}));a=n.O(a)})();
//# sourceMappingURL=app.1063caac.js.map